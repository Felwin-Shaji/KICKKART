<%- include("../partials/user/header.ejs") -%>

    <style>
        .carousel-wrapper {
            position: relative;
        }

        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            padding: 15px 15px;
            cursor: pointer;
            z-index: 20;
            font-size: 18px;
        }

        .left-btn {
            left: 10px;
        }


        .right-btn {
            right: 10px;
        }

        .carousel-btn.left-btn {
            left: 10px;
        }

        .carousel-btn.right-btn {
            right: 10px;
        }

        .carousel-btn:hover {
            background-color: rgba(255, 255, 255, 0.7);
            color: black;
            transform: scale(1.1);
        }

        .carousel-wrapper {
            position: relative;
            max-width: 500px;
            /* Adjust the width as needed */
            max-height: 500px;
            /* Adjust the height as needed */
            margin: 0 auto;
            /* Center the carousel */
            overflow: hidden;
            /* Prevent content from overflowing the boundaries */
        }

        .owl-carousel .item img {
            width: 100%;
            height: auto;
            /* Maintain aspect ratio of the images */
            object-fit: cover;
            /* Ensure images fit nicely inside their container */
        }

        .zoom-img {
            transition: transform 0.3s ease-in-out;
            width: 100%;
            height: auto;
        }

        .zoom-img:hover {
            transform: scale(1.1);
        }

        .thumbnail-wrapper {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }

        .thumbnail {
            width: 80px;
            /* Adjust thumbnail size */
            height: 80px;
            object-fit: cover;
            border: 2px solid transparent;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: #007bff;
            /* Highlight the active/hovered thumbnail */
        }

        .image-zoom-container {
            position: relative;
            display: inline-block;
            overflow: hidden;
        }

        .zoom-image {
            width: 100%;
            /* Ensure the image is responsive */
            display: block;
        }

        .zoom-lens {
            position: absolute;
            width: 120px;
            /* Width of the zoomed area */
            height: 150px;
            /* Height of the zoomed area */
            border: 2px solid #000;
            background-repeat: no-repeat;
            pointer-events: none;
            display: none;
            /* Initially hidden */
            z-index: 10;
            /* Ensure it appears above other elements */
        }

        .variant-option {
            cursor: pointer;
            border: 1px solid #ddd;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 3px;
        }

        .variant-option.selected {
            background-color: #2a2a2a;
            color: #fff;
            font-weight: bold;
        }
    </style>

    <div class="colorlib-product">
        <div class="container">
            <div class="row row-pb-lg product-detail-wrap">
                <div class="col-sm-8">
                    <div class="carousel-wrapper">
                        <div class="owl-carousel">
                            <div class="item">
                                <div class="product-entry border image-zoom-container">
                                    <a href="#" class="prod-img">
                                        <img src="/uploads/re-image/<%= product.productImage[0] %>"
                                            class="img-fluid zoom-image" alt="Product Image 1">
                                        <div class="zoom-lens"></div>
                                    </a>
                                </div>
                            </div>

                            <div class="item">
                                <div class="product-entry border image-zoom-container">
                                    <a href="#" class="prod-img">
                                        <img src="/uploads/re-image/<%= product.productImage[1] %>"
                                            class="img-fluid zoom-image" alt="Product Image 1">
                                        <div class="zoom-lens"></div>
                                    </a>
                                </div>
                            </div>
                            <div class="item">
                                <div class="product-entry border image-zoom-container">
                                    <a href="#" class="prod-img">
                                        <img src="/uploads/re-image/<%= product.productImage[2] %>"
                                            class="img-fluid zoom-image" alt="Product Image 1">
                                        <div class="zoom-lens"></div>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <!-- Navigation Buttons -->
                        <button class="carousel-btn left-btn">&#8249;</button>
                        <button class="carousel-btn right-btn">&#8250;</button>
                    </div>

                    <div class="thumbnail-wrapper">
                        <img src="/uploads/re-image/<%=product.productImage[0]%>" class="thumbnail" data-index="0"
                            alt="Thumbnail 1">
                        <img src="/uploads/re-image/<%=product.productImage[1]%>" class="thumbnail" data-index="1"
                            alt="Thumbnail 2">
                        <img src="/uploads/re-image/<%=product.productImage[2]%>" class="thumbnail" data-index="2"
                            alt="Thumbnail 3">
                    </div>

                </div>
                <div class="col-sm-4">
                    <div class="product-desc">
                        <h3>
                            <%=product.productName%>
                        </h3>
                        <h4>
                            <%=product.brand%>
                        </h4>
                        <p class="price">
                            <span>$<%=product.salePrice%></span>
                            <span style="text-decoration: line-through;">$<%= product.regularPrice %></span> Regular
                            Price
                            <span class="save-price font-md color3 ml-15">
                                <% if(!totalOffer) {%>
                                    No offers
                                    <% }else{ %>
                                        <%=product.totalOffer%>%
                                            <% } %>
                            </span>
                            <span class="rate">
                                <i class="icon-star-full"></i>
                                <i class="icon-star-full"></i>
                                <i class="icon-star-full"></i>
                                <i class="icon-star-full"></i>
                                <i class="icon-star-half"></i>
                                (74 Rating)
                            </span>
                        </p>
                        <p>
                            <%=product.description%>
                        </p>
                        <div class="size-wrap">
                            <div class="block-26 mb-2">
                                <h4>Size</h4>
                                <ul>
                                    <% for(let i=0;i<varientSize.length;i++) {%>
                                        <li class="variant-option" data-size="<%=varientSize[i] %>">
                                            <%= varientSize[i] %>
                                        </li>
                                        <% } %>
                                </ul>
                            </div>
                        </div>
                        <div class="input-group mb-4">
                            <h5>Quantity :</h5>
                            <span class="input-group-btn">
                                <button type="button" class="quantity-left-minus btn" data-type="minus"
                                    data-field="quantity">-
                                </button>
                            </span>
                            <input type="text" id="quantity" name="quantity" class="form-control input-number" value="1"
                                min="1" max="7" readonly>
                            <span class="input-group-btn ml-1">
                                <button type="button" class="quantity-right-plus btn" data-type="plus"
                                    data-field="quantity">+
                                </button>
                            </span>
                        </div>

                        <div>
                            <div class="col-sm-12 text-center">
                                <p class="addtocart"><a class="btn btn-primary btn-addtocart"
                                        data-product-id="<%=product._id %>"><i class="icon-shopping-cart"></i> Add to
                                        Cart</a></p>
                                <!-- <p class="addtocart"><a href="/cart" class="btn btn-primary btn-addtocart"> Order Nowwwww</a></p> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <div class="row">
                        <div class="col-md-12 pills">
                            <div class="bd-example bd-example-tabs">
                                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">

                                    <li class="nav-item">
                                        <a class="nav-link active" id="pills-description-tab" data-toggle="pill"
                                            href="#pills-description" role="tab" aria-controls="pills-description"
                                            aria-expanded="true">Description</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="pills-manufacturer-tab" data-toggle="pill"
                                            href="#pills-manufacturer" role="tab" aria-controls="pills-manufacturer"
                                            aria-expanded="true">Manufacturer</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="pills-review-tab" data-toggle="pill"
                                            href="#pills-review" role="tab" aria-controls="pills-review"
                                            aria-expanded="true">Review</a>
                                    </li>
                                </ul>

                                <div class="tab-content" id="pills-tabContent">
                                    <div class="tab-pane border fade show active" id="pills-description" role="tabpanel"
                                        aria-labelledby="pills-description-tab">
                                        <p>Even the all-powerful Pointing has no control about the blind texts it is an
                                            almost unorthographic life One day however a small line of blind text by the
                                            name of Lorem Ipsum decided to leave for the far World of Grammar.</p>
                                        <p>When she reached the first hills of the Italic Mountains, she had a last view
                                            back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet
                                            Village and the subline of her own road, the Line Lane. Pityful a rethoric
                                            question ran over her cheek, then she continued her way.</p>
                                        <ul>
                                            <li>The Big Oxmox advised her not to do so</li>
                                            <li>Because there were thousands of bad Commas</li>
                                            <li>Wild Question Marks and devious Semikoli</li>
                                            <li>She packed her seven versalia</li>
                                            <li>tial into the belt and made herself on the way.</li>
                                        </ul>
                                    </div>

                                    <div class="tab-pane border fade" id="pills-manufacturer" role="tabpanel"
                                        aria-labelledby="pills-manufacturer-tab">
                                        <p>Even the all-powerful Pointing has no control about the blind texts it is an
                                            almost unorthographic life One day however a small line of blind text by the
                                            name of Lorem Ipsum decided to leave for the far World of Grammar.</p>
                                        <p>When she reached the first hills of the Italic Mountains, she had a last view
                                            back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet
                                            Village and the subline of her own road, the Line Lane. Pityful a rethoric
                                            question ran over her cheek, then she continued her way.</p>
                                    </div>

                                    <div class="tab-pane border fade" id="pills-review" role="tabpanel"
                                        aria-labelledby="pills-review-tab">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <h3 class="head">23 Reviews</h3>
                                                <div class="review">
                                                    <div class="user-img"
                                                        style="background-image: url(images/person1.jpg)"></div>
                                                    <div class="desc">
                                                        <h4>
                                                            <span class="text-left">Jacob Webb</span>
                                                            <span class="text-right">14 March 2018</span>
                                                        </h4>
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-half"></i>
                                                                <i class="icon-star-empty"></i>
                                                            </span>
                                                            <span class="text-right"><a href="#" class="reply"><i
                                                                        class="icon-reply"></i></a></span>
                                                        </p>
                                                        <p>When she reached the first hills of the Italic Mountains, she
                                                            had a last view back on the skyline of her hometown
                                                            Bookmarksgrov</p>
                                                    </div>
                                                </div>
                                                <div class="review">
                                                    <div class="user-img"
                                                        style="background-image: url(images/person2.jpg)"></div>
                                                    <div class="desc">
                                                        <h4>
                                                            <span class="text-left">Jacob Webb</span>
                                                            <span class="text-right">14 March 2018</span>
                                                        </h4>
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-half"></i>
                                                                <i class="icon-star-empty"></i>
                                                            </span>
                                                            <span class="text-right"><a href="#" class="reply"><i
                                                                        class="icon-reply"></i></a></span>
                                                        </p>
                                                        <p>When she reached the first hills of the Italic Mountains, she
                                                            had a last view back on the skyline of her hometown
                                                            Bookmarksgrov</p>
                                                    </div>
                                                </div>
                                                <div class="review">
                                                    <div class="user-img"
                                                        style="background-image: url(images/person3.jpg)"></div>
                                                    <div class="desc">
                                                        <h4>
                                                            <span class="text-left">Jacob Webb</span>
                                                            <span class="text-right">14 March 2018</span>
                                                        </h4>
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-half"></i>
                                                                <i class="icon-star-empty"></i>
                                                            </span>
                                                            <span class="text-right"><a href="#" class="reply"><i
                                                                        class="icon-reply"></i></a></span>
                                                        </p>
                                                        <p>When she reached the first hills of the Italic Mountains, she
                                                            had a last view back on the skyline of her hometown
                                                            Bookmarksgrov</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="rating-wrap">
                                                    <h3 class="head">Give a Review</h3>
                                                    <div class="wrap">
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                (98%)
                                                            </span>
                                                            <span>20 Reviews</span>
                                                        </p>
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-empty"></i>
                                                                (85%)
                                                            </span>
                                                            <span>10 Reviews</span>
                                                        </p>
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-empty"></i>
                                                                <i class="icon-star-empty"></i>
                                                                (70%)
                                                            </span>
                                                            <span>5 Reviews</span>
                                                        </p>
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-empty"></i>
                                                                <i class="icon-star-empty"></i>
                                                                <i class="icon-star-empty"></i>
                                                                (10%)
                                                            </span>
                                                            <span>0 Reviews</span>
                                                        </p>
                                                        <p class="star">
                                                            <span>
                                                                <i class="icon-star-full"></i>
                                                                <i class="icon-star-empty"></i>
                                                                <i class="icon-star-empty"></i>
                                                                <i class="icon-star-empty"></i>
                                                                <i class="icon-star-empty"></i>
                                                                (0%)
                                                            </span>
                                                            <span>0 Reviews</span>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>

        document.addEventListener("DOMContentLoaded", () => {
            // DOM Elements
            const sizeList = document.querySelectorAll(".variant-option");
            const addToCartButton = document.querySelector(".btn-addtocart");
            const quantityInput = document.getElementById("quantity");


            let selectedSize = null; // To store the selected size

            const handleQuantity = () => {
                const btnDecrease = document.querySelector(".quantity-left-minus");
                const btnIncrease = document.querySelector(".quantity-right-plus");
                const minQuantity = parseInt(quantityInput.getAttribute("min")) || 1;
                const maxQuantity = parseInt(quantityInput.getAttribute("max")) || 10;

                btnDecrease.addEventListener("click", () => {
                    let currentValue = parseInt(quantityInput.value) || minQuantity;
                    if (currentValue > minQuantity) {
                        quantityInput.value = currentValue - 1;
                    } else {
                        alert(`Minimum quantity is ${minQuantity}`);
                    }
                });

                btnIncrease.addEventListener("click", () => {
                    let currentValue = parseInt(quantityInput.value) || minQuantity;
                    if (currentValue < maxQuantity) {
                        quantityInput.value = currentValue + 1;
                    } else {
                        alert(`Maximum quantity is ${maxQuantity}`);
                    }
                });

            }

            //Initialize the quantity handlers
            handleQuantity();

            // Function to handle size selection
            const handleSizeSelection = (event) => {
                selectedSize = event.target.getAttribute("data-size");
                console.log("Selected Size:", selectedSize);

                // Highlight the selected size
                sizeList.forEach(sizeElement => sizeElement.classList.remove("selected"));
                event.target.classList.add("selected");
            };

            // Attach click event listeners to all size options
            sizeList.forEach(sizeElement => {
                sizeElement.addEventListener("click", handleSizeSelection);
            });

            // Function to handle Add to Cart click
            const handleAddToCart = async () => {
                if (!selectedSize) {
                    console.error("No size selected! Please select a size.");
                    alert("Please select a size before adding to cart.");
                    return;
                }

                const productId = addToCartButton.getAttribute("data-product-id");
                const quantity = parseInt(quantityInput.value) || 1;
                console.log("Product ID:", productId);
                console.log("Quantity: ", quantity)

                try {
                    const response = await fetch("/cart", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ productId, selectedSize, quantity }),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    console.log("response:", response);

                    const result = await response.json();
                    console.log("Result:", result);

                    if (result.success) {
                        alert(result.message || "Item added to your cart!");
                        window.location.href = "/cart";
                    } else {
                           console.error("Error adding to cart:", result.message);
                            alert(result.message || "Failed to add item to cart.");
                    }
                } catch (error) {
                    console.log("Error at Add to Cart:", error);
                    alert("An error occurred. Please try again.");
                }
            };

            // Attach click event listener to Add to Cart button
            addToCartButton.addEventListener("click", handleAddToCart);
        });





        $(document).ready(function () {
            const owl = $('.owl-carousel');
            owl.owlCarousel({
                items: 1,
                loop: true,
                nav: false,
            });

            // Custom navigation buttons
            $('.left-btn').click(function () {
                owl.trigger('prev.owl.carousel');
            });

            $('.right-btn').click(function () {
                owl.trigger('next.owl.carousel');
            });

            // Thumbnail click functionality
            $('.thumbnail').click(function () {
                const index = $(this).data('index');
                owl.trigger('to.owl.carousel', [index]);
                $('.thumbnail').removeClass('active');
                $(this).addClass('active');
            });

            // Update active thumbnail on carousel change
            owl.on('changed.owl.carousel', function (event) {
                const currentIndex = event.item.index - event.relatedTarget._clones.length / 2;
                const index = currentIndex >= 0
                    ? currentIndex % event.item.count
                    : (event.item.count + currentIndex) % event.item.count;
                $('.thumbnail').removeClass('active');
                $(`.thumbnail[data-index="${index}"]`).addClass('active');
            });

            // Set the first thumbnail as active initially
            $('.thumbnail').eq(0).addClass('active');
        });





        $(document).ready(function () {
            $('.image-zoom-container').on('mouseenter', function () {
                $(this).find('.zoom-lens').show();
            });

            $('.image-zoom-container').on('mouseleave', function () {
                $(this).find('.zoom-lens').hide();
            });

            $('.image-zoom-container').on('mousemove', function (e) {
                const zoomLens = $(this).find('.zoom-lens');
                const zoomImage = $(this).find('.zoom-image');
                const containerOffset = $(this).offset();

                const mouseX = e.pageX - containerOffset.left;
                const mouseY = e.pageY - containerOffset.top;

                const lensWidth = zoomLens.width();
                const lensHeight = zoomLens.height();

                // Calculate the background position for the zoom effect
                const bgPosX = (mouseX / zoomImage.width()) * 100;
                const bgPosY = (mouseY / zoomImage.height()) * 100;

                // Update the zoom lens position and background
                zoomLens.css({
                    left: mouseX - lensWidth / 2,
                    top: mouseY - lensHeight / 2,
                    backgroundImage: `url(${zoomImage.attr('src')})`,
                    backgroundSize: `${zoomImage.width()}px ${zoomImage.height()}px`,
                    backgroundPosition: `${bgPosX}% ${bgPosY}%`
                });
            });
        });

        // $(document).ready(function () {
        //     // When the "+" button is clicked
        //     $(".quantity-right-plus").click(function (e) {
        //         e.preventDefault();
        //         var quantity = parseInt($("#quantity").val()); // Get current quantity
        //         var maxQuantity = $("#quantity").attr("max"); // Get max quantity

        //         // Check if quantity is less than max
        //         if (quantity < maxQuantity) {
        //             $("#quantity").val(quantity + 1); // Increment the quantity
        //         }
        //     });

            // When the "-" button is clicked
            // $(".quantity-left-minus").click(function (e) {
            //     e.preventDefault();
            //     var quantity = parseInt($("#quantity").val()); // Get current quantity
            //     var minQuantity = $("#quantity").attr("min"); // Get min quantity

            //     // Check if quantity is greater than min
            //     if (quantity > minQuantity) {
            //         $("#quantity").val(quantity - 1); // Decrement the quantity
            //     }
            // });
        // });





    </script>

    <%- include("../partials/user/footer.ejs") -%>